name: Maven Build - WebRTC Signaling Server

# 触发条件：推送到 main 分支、创建 Pull Request，或手动触发
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:  # 允许在网页上手动点击运行

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 步骤 1：拉取代码
      - name: Checkout code
        uses: actions/checkout@v4

      # 步骤 2：设置 JDK 11
      - name: Set up JDK 11
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'temurin'
          cache: maven  # 缓存 Maven 依赖，加速构建

      # 步骤 3：使用 Maven 构建项目
      - name: Build with Maven
        run: mvn clean package -DskipTests

      # 步骤 4：上传 JAR 文件作为构建产物
      - name: Upload JAR artifact
        uses: actions/upload-artifact@v4
        with:
          name: signaling-server-jar
          # 根据你的 pom.xml，生成的 JAR 文件名是这个
          path: target/webrtc-signaling-server-1.0.0.jar
          retention-days: 30  # 保存 30 天
          if-no-files-found: error
